import * as tomato from "@po-to/tomato";
import * as tdom from "@po-to/tomato-jquery";
import * as project from "static/libs/project";

export =  class View extends project.View {
    private _links:{[key:string]:JQuery} = {};
    private _selected:JQuery|null = null;

    constructor(viewComponent: tomato.IViewComponent, parent?: tomato.View, vid?: string){
        super(viewComponent, parent, vid);
        this._watchEvent();
        this.find(".nav a").each((i,o)=>{
            this._links[o.innerHTML] = $(o);
        })
        tomato.application.history.addListener(tomato.CmdEvent.CmdSuccess,()=>{
            this.select();
        });
        tomato.application.addListener(tomato.ViewEvent.Inited,()=>{
            this.select();
        });
    }
    toggleNav(){
        return true;
    }
    select(){
        if(this._selected){
            this._selected.removeClass("on");
            this._selected = null;
        }
        let app:project.Application = tomato.application as any;
        let channel = app.article.config.channel;
        if(this._links[channel]){
            this._selected = this._links[channel];
            this._selected.addClass("on");
        }
    }
}